<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8">
    <title>Or√ßamento</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css" />
    <link rel="stylesheet" href="css/bootstrap.css" />
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <button id="selectCategoryButton" class="btn btn-primary m-3">Selecione uma categoria</button>
    <div id="outerContainer" class="border rounded my-3 p-3 collapse">
        <div id="innerContainer" class="m-auto">
            <h5 class="p-1">Selecione a categoria</h5>
            <div id="categoryContainer" class="border rounded mb-3 p-1">
                <div id="categories" class="d-flex h-100 mh-100 overflow-auto"></div>
            </div>
            <div id="buttonsContainer" class="d-flex justify-content-end">
                <button id="okButton" class="btn btn-primary col-2">OK</button>
                <button id="cancelButton" class="btn btn-primary ml-3 col-2">Cancelar</button>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
      crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
      integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
      crossorigin="anonymous"></script>
    <script>
        $(document).ready(function() {
            //$.get("http://localhost:3000/categories", function(result) {
            $.get("https://liigo-orcamento.herokuapp.com/categories", function(result) {                
                $("#categories").html(result);

                $('#first-level').on('hide.bs.tab', 'a', function() {
                    $('#fourth-level>div').removeClass('active show')
                    $('#fourth-level>div>a').removeClass('active show')
                    $('#third-level>div').removeClass('active show')
                    $('#third-level>div>a').removeClass('active show')
                    $('#second-level>div').removeClass('active show')
                    $('#second-level>div>a').removeClass('active show')
                })
                $('#second-level').on('hide.bs.tab', 'div', function() {
                    $('#fourth-level>div').removeClass('active show')
                    $('#fourth-level>div>a').removeClass('active show')
                    $('#third-level>div').removeClass('active show')
                    $('#third-level>div>a').removeClass('active show')
                })
                $('#third-level').on('hide.bs.tab', 'div', function() {
                    $('#fourth-level>div').removeClass('active show')
                    $('#fourth-level>div>a').removeClass('active show')
                })
                $('#cancelButton').click(function() {
                    $('#selectCategoryButton').removeClass('collapse')
                    $('#outerContainer').addClass('collapse')
                    $('#iframeCategory', window.parent.document).height('55px');
                })
                $('#okButton').click(function() {
                    const referenceCategorySelected = $('a.active').last().attr('aria-controls')
                    const nameCategorySelected = $('a.active').last().text()
                    //$.get("http://localhost:3000/stores/" + referenceCategorySelected, function(result) {
                    $.get("https://liigo-orcamento.herokuapp.com/stores/" + referenceCategorySelected, function(result) {
                        window.parent.postMessage(result, '*')
                        if (nameCategorySelected) {
                            $('#selectCategoryButton').removeClass('collapse').text(nameCategorySelected)
                            $('#outerContainer').addClass('collapse')
                            $('#iframeCategory', window.parent.document).height('55px');
                        }
                    });
                })
                $('#selectCategoryButton').click(function () {
                    $('#iframeCategory', window.parent.document).height('548px');
                    $(this).addClass('collapse')
                    $('#outerContainer').removeClass('collapse')
                })
            });
        });
    </script>
</body>

</html>
